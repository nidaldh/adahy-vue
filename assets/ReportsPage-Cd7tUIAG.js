import{d as C,p as w,r as y,o as R,c as m,a as s,b as k,g as T,y as _,m as g,L as G,E as I,t as n,n as L,h as r,_ as x}from"./index-D2cXNYYD.js";import{u as N}from"./payments-CZv0c8BV.js";const E={class:"balance-sheet-container card-style",dir:"rtl"},W={key:1,class:"summary-grid"},F={class:"summary-item total-sales"},O={class:"details"},$={class:"value"},M={key:0,class:"summary-item total-discounts"},z={class:"details"},U={class:"value discount-amount"},j={class:"sub-details"},q={key:1,class:"summary-item original-revenue"},H={class:"details"},J={class:"value"},K={class:"summary-item total-payments-received"},Q={class:"details"},X={class:"value"},Y={class:"summary-item total-outstanding-balance"},Z={class:"details"},ss={class:"value text-warning"},ts={class:"summary-item net-cashflow"},as={class:"details"},es={class:"summary-item total-customers"},ls={class:"details"},ns={class:"value"},os={class:"summary-item total-animals"},is={class:"details"},us={class:"value"},rs={class:"actions"},cs=["disabled"],ds={key:2,class:"last-updated"},vs=C({__name:"BalanceSheetTable",setup(P){const i=w(),o=N(),c=y(!1),f=y(null),h=y(null),a=y({totalSalesValue:0,totalSalesValueBeforeDiscount:0,totalDiscountsGiven:0,totalPaymentsReceived:0,totalOutstandingBalance:0,totalCustomers:0,totalActiveAnimals:0,customersWithDiscounts:0}),D=async()=>{c.value=!0,f.value=null;try{(!i.customers.length||i.lastFetchTimestamp===0)&&await i.fetchCustomers(),(!o.payments.length||o.lastFetchTimestamp===0)&&await o.fetchPayments();let l=0,t=0,v=0;a.value.totalSalesValue=i.customers.reduce((u,e)=>{var S;const p=((S=e.animals)==null?void 0:S.reduce((B,A)=>A.status!=="ملغي"?B+(A.total||0):B,0))||0;l+=p,e.discount&&e.discount>0&&(t+=e.discount,v++);const b=e.finalTotalAmount!==void 0?e.finalTotalAmount:p;return u+b},0),a.value.totalSalesValueBeforeDiscount=l,a.value.totalDiscountsGiven=t,a.value.customersWithDiscounts=v,a.value.totalPaymentsReceived=o.payments.reduce((u,e)=>u+e.amount,0),a.value.totalOutstandingBalance=i.customers.reduce((u,e)=>u+(e.balance>0?e.balance:0),0),a.value.totalCustomers=i.customers.length,a.value.totalActiveAnimals=i.customers.reduce((u,e)=>{var p;return u+(((p=e.animals)==null?void 0:p.filter(b=>b.status!=="ملغي").length)||0)},0),h.value=new Date}catch(l){console.error("Error fetching summary data:",l),f.value="حدث خطأ أثناء تحميل بيانات الملخص."}finally{c.value=!1}},d=l=>new Intl.NumberFormat("he-IL",{style:"currency",currency:"ILS"}).format(l),V=(l,t=!1)=>{if(!l)return"N/A";const v={year:"numeric",month:"short",day:"numeric"};t&&(v.hour="2-digit",v.minute="2-digit");try{return new Date(l).toLocaleDateString("ar-EG",v)}catch{return"Invalid Date"}};return R(()=>{D()}),(l,t)=>(r(),m("div",E,[t[17]||(t[17]=s("h3",null,[s("i",{class:"fas fa-balance-scale"}),g(" الميزانية العمومية (ملخص)")],-1)),k(G,{loading:c.value},null,8,["loading"]),f.value?(r(),T(I,{key:0,message:f.value},null,8,["message"])):_("",!0),!c.value&&!f.value?(r(),m("div",W,[s("div",F,[t[1]||(t[1]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-chart-line"})],-1)),s("div",O,[t[0]||(t[0]=s("span",{class:"label"},"إجمالي قيمة المبيعات (الأضاحي)",-1)),s("span",$,n(d(a.value.totalSalesValue)),1)])]),a.value.totalDiscountsGiven>0?(r(),m("div",M,[t[3]||(t[3]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-percent"})],-1)),s("div",z,[t[2]||(t[2]=s("span",{class:"label"},"إجمالي الخصومات المقدمة",-1)),s("span",U,n(d(a.value.totalDiscountsGiven)),1),s("div",j,[s("small",null,n(a.value.customersWithDiscounts)+" عميل لديه خصم",1)])])])):_("",!0),a.value.totalDiscountsGiven>0?(r(),m("div",q,[t[5]||(t[5]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-receipt"})],-1)),s("div",H,[t[4]||(t[4]=s("span",{class:"label"},"إجمالي الإيرادات قبل الخصم",-1)),s("span",J,n(d(a.value.totalSalesValueBeforeDiscount)),1)])])):_("",!0),s("div",K,[t[7]||(t[7]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-hand-holding-usd"})],-1)),s("div",Q,[t[6]||(t[6]=s("span",{class:"label"},"إجمالي المدفوعات المستلمة",-1)),s("span",X,n(d(a.value.totalPaymentsReceived)),1)])]),s("div",Y,[t[9]||(t[9]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-hourglass-half"})],-1)),s("div",Z,[t[8]||(t[8]=s("span",{class:"label"},"إجمالي الرصيد المستحق (على العملاء)",-1)),s("span",ss,n(d(a.value.totalOutstandingBalance)),1)])]),s("div",ts,[t[11]||(t[11]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-exchange-alt"})],-1)),s("div",as,[t[10]||(t[10]=s("span",{class:"label"},"صافي التدفق النقدي (المستلم)",-1)),s("span",{class:L(["value",a.value.totalPaymentsReceived>=0?"text-success":"text-danger"])},n(d(a.value.totalPaymentsReceived)),3)])]),s("div",es,[t[13]||(t[13]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-users"})],-1)),s("div",ls,[t[12]||(t[12]=s("span",{class:"label"},"عدد العملاء النشطين",-1)),s("span",ns,n(a.value.totalCustomers),1)])]),s("div",os,[t[15]||(t[15]=s("div",{class:"icon-container"},[s("i",{class:"fas fa-sheep"})],-1)),s("div",is,[t[14]||(t[14]=s("span",{class:"label"},"عدد الأضاحي المسجلة (غير الملغاة)",-1)),s("span",us,n(a.value.totalActiveAnimals),1)])])])):_("",!0),s("div",rs,[s("button",{onClick:D,class:"btn btn-secondary",disabled:c.value},t[16]||(t[16]=[s("i",{class:"fas fa-sync-alt"},null,-1),g(" تحديث البيانات ")]),8,cs)]),!c.value&&h.value?(r(),m("div",ds," آخر تحديث للبيانات: "+n(V(h.value,!0)),1)):_("",!0)]))}}),ms=x(vs,[["__scopeId","data-v-338a8f80"]]),fs={class:"reports-page",dir:"rtl"},ps={class:"report-section"},_s=C({__name:"ReportsPage",setup(P){return(i,o)=>(r(),m("div",fs,[o[0]||(o[0]=s("h2",null,[s("i",{class:"fas fa-chart-pie"}),g(" التقارير")],-1)),s("div",ps,[k(ms)]),o[1]||(o[1]=s("div",{class:"report-section placeholder-section"},[s("h3",null,[s("i",{class:"fas fa-file-alt"}),g(" تقارير إضافية (قيد التطوير)")]),s("p",null,"سيتم إضافة المزيد من التقارير التفصيلية هنا، مثل:"),s("ul",null,[s("li",null,"تقرير مبيعات حسب نوع الأضحية."),s("li",null,"تقرير العملاء الأكثر نشاطاً."),s("li",null,"ملخص الأرباح والخسائر (يتطلب إدخال التكاليف)."),s("li",null,"تقرير حالة الأضاحي (محجوز، مذبوح، الخ).")])],-1))]))}}),hs=x(_s,[["__scopeId","data-v-88b18abc"]]);export{hs as default};
